version: 2
jobs:
  build:
    docker:
    - image: circleci/openjdk:11.0.1-jdk

    working_directory: ~/tennis-restful

    steps:
    # git pull
    - checkout

    # setup testing env
    - run:
        name: Login to DockerHub
        command: docker login -u $DOCKER_USER -p $DOCKER_PASS

    # Download and cache dependencies
    - restore_cache:
        keys:
        - tennis-restful-{{ checksum "pom.xml" }}

    - run: mvn dependency:go-offline

    - save_cache:
        paths:
        - ~/.m2
        key: tennis-restful-{{ checksum "pom.xml" }}

    # package into a jar
    - run: mvn clean package

    # build and push docker image to docker hub
    - run: curl --data build=true -X POST https://hub.docker.com/api/build/v1/source/65e35d22-f68c-4a86-b4bd-3f987bcf6595/trigger/3283f274-4a23-41f4-b8a0-ceef5023ceea

    # store raw contents of src code
    - store_artifacts:
        path: target/classes
        destination: tennis-restful